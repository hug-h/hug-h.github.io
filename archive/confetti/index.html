<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>confetti</title>

    <style>
        #confetti {
            width: 100%;
            height: 100%;
            font-family: serif;
            z-index: -1;
            position: fixed;
            top: 0;
            left: 0;
            color: black;
            filter: blur(1px);

            div {
                width: 100%;
                text-align: center;
                justify-content: space-between;
                font-size: 2vh;
                line-height: 1vh;
                display: flex;
                padding-top: 0.5vh;
                padding-bottom: 0.5vh;
            }
        }

        input {
            background-color: rgba(255, 255, 255, .5);
        }

        .hidden {
            display: none;
        }
    </style>


    <script>
        let density = 100;
        let interval = 100;
        let numInputs = 3;
        let confettiInterval;

        function load() {
            build(numInputs);
            animate();
        }

        function animate() {
            if(confettiInterval){clearInterval(confettiInterval)};
            confettiInterval = setInterval(animConfetti, interval);
        }

        function animConfetti() {
            target = document.getElementById("confetti");
            target.innerHTML = ""
            for (i = 0; i < 50; i++) {

                line = document.createElement("div");
                for (y = 0; y < Math.floor(Math.random() * density + 2); y++) {
                    bit = document.createElement("span")
                    bit.innerHTML = randFigure()
                    if (Math.random() >.5) {
                        bit.style.color = "rgba(255,0,0, 0.8)";
                    }
                    line.appendChild(bit);
                }
                target.appendChild(line);
            }
        }

        function randFigure() {
            return figures[Math.trunc(Math.random() * figures.length)];
        }

        let figures = ['*', 'o', '.', '_', '?', ' ', ' ']

        //build the site

        function build(nInputs) {
            console.log(figures);
            inputContainer = document.getElementById("inputs");
            inputs.innerHTML = '';
            for (i = 0; i < nInputs; i++) {
                input = document.createElement("input");
                input.type = "text";
                input.id = "word" + i;
                if (i == 0) {
                    input.autofocus = true;
                }
                inputContainer.appendChild(input);
                inputContainer.appendChild(document.createElement("br"));
            }

            //add listener to update the figure array after every keystroke
            inputContainer.addEventListener('keyup', (key) => {
                for (i = 0; i < nInputs; i++) {
                    val = document.getElementById("word" + i).value;
                    figures[i + 2] = val;
                    checkForCmd(val);
                }
            });

            //add listener to hide the inputs on mobile when screen tapped
            document.getElementById("confetti").addEventListener('mousedown', () => {
                inputContainer.classList.toggle("hidden");
            })
        }

        //check inputs for strings of (#_letter_integer) where letter is the i or d charachter
        //#i will change the animation interval
        //#d will change the density of the animation
        function checkForCmd(value) {
            test = /#(d|i)(\d+)/.exec(value);
            if (test) {
                val = test[2];
                switch (test[1]) {
                    case "d":
                        console.log("density" + val);
                        density = val;
                        break;
                    case "i":
                        console.log("interval" + val);
                        interval = val;
                        animate();
                        break;
                }
            }
            //if(/#\d+/.test(value));
        }
    </script>



</head>

<body onload="(load())">
    <div id="inputs"></div>
    <div id="confetti"></div>

</body>